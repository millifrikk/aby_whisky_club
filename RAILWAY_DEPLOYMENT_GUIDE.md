# Railway Deployment Guide - √Öby Whisky Club

## üöÄ Quick Deployment Steps

### **Prerequisites**
- GitHub account
- Railway account (sign up at https://railway.app)
- Your project pushed to GitHub

### **Step 1: Railway Account Setup**
1. Go to https://railway.app and sign up with GitHub
2. Verify your account and get your $5 trial credit
3. Connect your GitHub repository

### **Step 2: Deploy PostgreSQL Database**
1. In Railway dashboard, click "New Project"
2. Select "Deploy from GitHub repo"
3. Choose your `aby_whisky_club` repository
4. Railway will auto-detect the `railway.json` configuration
5. Add a PostgreSQL database service:
   - Click "Add Service" ‚Üí "Database" ‚Üí "PostgreSQL"
   - Note the generated `DATABASE_URL`

### **Step 3: Configure Environment Variables**

#### **Backend Service Variables:**
```bash
NODE_ENV=production
DATABASE_URL=[Auto-generated by Railway PostgreSQL]
JWT_SECRET=your-super-secure-jwt-secret-minimum-32-characters
CORS_ORIGIN=https://your-frontend-domain.railway.app
PORT=3001
```

#### **Frontend Service Variables:**
```bash
VITE_API_URL=https://your-backend-domain.railway.app/api
NODE_ENV=production
```

### **Step 4: Deploy Services**
1. **Database**: Should deploy automatically
2. **Backend**: Will build using `backend/Dockerfile.prod`
3. **Frontend**: Will build using `frontend/Dockerfile.prod`

### **Step 5: Database Initialization**
After backend deployment, initialize the database:
1. Go to backend service in Railway
2. Open the "Deploy Logs" tab
3. The database should auto-initialize on first run
4. Or manually run: `npm run init-db` if needed

### **Step 6: Configure Custom Domains (Optional)**
1. In Railway dashboard, go to each service
2. Click "Settings" ‚Üí "Domains"
3. Add custom domain or use Railway-provided URLs

---

## üîß Configuration Files Created

### **Railway Configuration (`railway.json`)**
- Multi-service setup with PostgreSQL, Backend, and Frontend
- Automatic environment variable linking
- HTTP path routing configuration

### **Production Dockerfiles**
- **Backend** (`backend/Dockerfile.prod`): Production-optimized Node.js
- **Frontend** (`frontend/Dockerfile.prod`): Multi-stage build with Nginx

### **Nginx Configuration (`frontend/nginx.conf`)**
- React Router support
- Static asset caching
- Security headers
- Gzip compression

---

## üåç Environment Variables Guide

### **Required Environment Variables**

#### **Backend:**
| Variable | Description | Example |
|----------|-------------|---------|
| `NODE_ENV` | Environment mode | `production` |
| `DATABASE_URL` | PostgreSQL connection | Auto-generated by Railway |
| `JWT_SECRET` | JWT signing key | `your-32-char-secret` |
| `CORS_ORIGIN` | Frontend URL for CORS | `https://frontend.railway.app` |
| `PORT` | Server port | `3001` |

#### **Frontend:**
| Variable | Description | Example |
|----------|-------------|---------|
| `VITE_API_URL` | Backend API URL | `https://backend.railway.app/api` |
| `NODE_ENV` | Build mode | `production` |

### **Optional Environment Variables**

#### **Email Configuration:**
```bash
EMAIL_HOST=smtp.gmail.com
EMAIL_PORT=587
EMAIL_USER=your-email@gmail.com
EMAIL_PASS=your-app-password
EMAIL_FROM=noreply@abywhiskyclub.com
```

#### **Security Configuration:**
```bash
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100
SESSION_SECRET=your-session-secret
SESSION_TIMEOUT=3600000
```

---

## üìä Expected Costs

### **Railway Pricing (2025)**
- **Trial**: $5 credit (one-time)
- **Hobby Plan**: $5/month + $5 credit
- **Resource Usage**: Pay-as-you-go beyond credit

### **Estimated Monthly Costs**
- **Database**: ~$2-4/month
- **Backend**: ~$1-3/month  
- **Frontend**: ~$1-2/month
- **Total**: ~$4-9/month (within $10 budget)

---

## üîç Troubleshooting

### **Common Issues**

#### **Build Failures**
```bash
# Check build logs in Railway dashboard
# Ensure all dependencies are in package.json
# Verify Dockerfile syntax
```

#### **Database Connection Issues**
```bash
# Verify DATABASE_URL is correctly set
# Check if database service is running
# Ensure backend waits for database to be ready
```

#### **CORS Errors**
```bash
# Verify CORS_ORIGIN matches frontend URL
# Check if both services are deployed
# Ensure HTTPS is used in production
```

#### **Environment Variable Issues**
```bash
# Double-check variable names (case-sensitive)
# Ensure Railway variables are saved
# Restart services after variable changes
```

### **Debugging Commands**
```bash
# View backend logs
railway logs --service backend

# View frontend logs  
railway logs --service frontend

# Connect to database
railway connect postgres
```

---

## ‚úÖ Post-Deployment Checklist

### **Functional Testing**
- [ ] Frontend loads correctly
- [ ] User registration works
- [ ] User login works
- [ ] Database queries execute
- [ ] Admin panel accessible
- [ ] Dark mode toggles
- [ ] Member directory displays
- [ ] API endpoints respond

### **Security Verification**
- [ ] HTTPS enabled on all services
- [ ] Environment variables secured
- [ ] CORS properly configured
- [ ] Security headers present
- [ ] JWT secrets unique and strong

### **Performance Check**
- [ ] Page load times < 3 seconds
- [ ] API response times < 500ms
- [ ] Static assets cached properly
- [ ] Gzip compression enabled

---

## üöÄ Going Live

### **Final Steps**
1. **Custom Domain**: Configure your own domain
2. **SSL Certificate**: Auto-managed by Railway
3. **Monitoring**: Set up Railway monitoring
4. **Backups**: Configure database backups
5. **Documentation**: Update README with live URLs

### **Live URLs Structure**
```
Frontend: https://your-app-name.railway.app
Backend:  https://your-app-name-backend.railway.app
Admin:    https://your-app-name.railway.app/admin
```

### **Default Admin Access**
```
Email: admin@abywhiskyclub.com
Password: AdminPass123!
```

---

## üìû Support

- **Railway Documentation**: https://docs.railway.app
- **Railway Community**: https://railway.app/discord
- **Troubleshooting**: Check Railway status page

---

**Deployment Time**: ~30-60 minutes  
**Go-Live**: Same day possible  
**Estimated Cost**: $5-10/month  

*This guide assumes familiarity with basic Git and terminal commands. All configuration files have been created and are ready for deployment.*